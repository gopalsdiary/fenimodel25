<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Super Admin Dashboard</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg: #e6ebf1; /* light neutral bluish gray */
            --bg-alt: #eef3f8;
            --shadow-light: rgba(255,255,255,0.9);
            --shadow-dark: rgba(163,177,198,0.55);
            --shadow-strong: rgba(163,177,198,0.75);
            --accent: #667eea; /* keep existing brand accent */
            --accent-alt: #764ba2;
            --text-main: #334155;
            --danger: #e74c3c;
            --success: #27ae60;
            --radius-lg: 28px;
            --transition: 0.25s cubic-bezier(.4,0,.2,1);
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:42px 20px;
            background: var(--bg);
            background-image: radial-gradient(circle at 25% 25%, #f6f9fc 0%, rgba(246,249,252,0) 60%),
                              radial-gradient(circle at 75% 70%, #f0f5fa 0%, rgba(240,245,250,0) 55%);
        }

        .container {
            position:relative;
            width:100%;
            max-width:420px;
            border-radius: var(--radius-lg);
            padding:0 0 34px;
            background: var(--bg);
            /* layered neumorphic shadow */
            box-shadow: 14px 14px 28px var(--shadow-dark),
                        -14px -14px 28px var(--shadow-light);
            animation: fadeIn .8s ease;
        }

        @keyframes fadeIn { from {opacity:0; transform:translateY(12px);} to {opacity:1; transform:translateY(0);} }

        .auth-header {
            position:relative;
            padding:46px 34px 40px;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            background: linear-gradient(145deg, var(--accent), var(--accent-alt));
            box-shadow: inset 6px 6px 14px rgba(0,0,0,0.15), inset -4px -4px 10px rgba(255,255,255,0.25);
            color:#fff;
            text-align:center;
        }
        .auth-header h1 { font-size:2rem; letter-spacing:.5px; margin:0 0 6px; font-weight:600; }
        .auth-header p { opacity:.92; font-size:.95rem; }

        .form-container { padding:34px 42px 0; }

        .form-group { margin-bottom:24px; position:relative; }
        .form-group label { display:block; font-weight:600; margin:0 0 10px; color:var(--text-main); font-size:.9rem; letter-spacing:.3px; }

        .form-group input {
            width:100%;
            padding:15px 18px 14px;
            font-size:.95rem;
            border:0;
            outline:none;
            border-radius:18px;
            background: var(--bg);
            color: var(--text-main);
            /* neumorphic inset */
            box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light);
            transition: var(--transition);
        }
        .form-group input:focus {
            box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light), 0 0 0 3px rgba(102,126,234,0.25);
        }
        .form-group input.error { box-shadow: inset 3px 3px 6px rgba(231,76,60,0.6), inset -3px -3px 6px rgba(255,255,255,0.9); }
        .form-group input.success { box-shadow: inset 3px 3px 6px rgba(39,174,96,0.5), inset -3px -3px 6px rgba(255,255,255,0.95); }

        .btn { position:relative; width:100%; padding:15px 18px; border:none; cursor:pointer; font-size:.95rem; font-weight:600; border-radius:20px; letter-spacing:.4px; display:inline-flex; align-items:center; justify-content:center; gap:8px; transition: var(--transition); background: var(--bg); color:var(--accent); box-shadow: 6px 6px 14px var(--shadow-dark), -6px -6px 14px var(--shadow-light); }
        .btn:focus-visible { outline:2px solid var(--accent); outline-offset:3px; }
        .btn:hover { transform:translateY(-2px); box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); }
        .btn:active { transform:translateY(1px); box-shadow: 4px 4px 10px var(--shadow-dark), -4px -4px 10px var(--shadow-light); }
        .btn-primary { color:#fff; background: linear-gradient(145deg, var(--accent), var(--accent-alt)); box-shadow: 6px 6px 14px var(--shadow-dark), -6px -6px 14px rgba(255,255,255,0.75); }
        .btn-primary:hover { box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px rgba(255,255,255,0.8); }
        .btn-secondary { background: var(--bg); color: var(--accent); }
        .btn-secondary:hover { color: var(--accent-alt); }
        .btn:disabled { opacity:.55; cursor:not-allowed; transform:none; }

        .form-toggle { text-align:center; margin-top:26px; font-size:.85rem; color:#64748b; }
        .form-toggle a { color: var(--accent); text-decoration:none; font-weight:600; }
        .form-toggle a:hover { text-decoration:underline; }

        .alert { padding:13px 15px; border-radius:16px; margin-bottom:20px; font-weight:500; font-size:.85rem; position:relative; box-shadow: inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light); }
        .alert-success { background:#d9f5e4; color:#196c3d; }
        .alert-error { background:#fae1e3; color:#7c1d26; }

        .loading { width:20px; height:20px; border:3px solid rgba(255,255,255,.35); border-top-color:#fff; border-radius:50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform:rotate(360deg); } }

        .dashboard { display:none; text-align:center; }
        .user-info { background: var(--bg); padding:26px 22px 24px; border-radius:24px; margin-bottom:28px; box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); }
        .user-avatar { width:90px; height:90px; margin:0 auto 18px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:2.2rem; font-weight:600; color:#fff; background: linear-gradient(145deg, var(--accent), var(--accent-alt)); box-shadow: 4px 4px 10px var(--shadow-dark), -4px -4px 9px rgba(255,255,255,0.9); }
        .user-info h3 { margin:0 0 6px; font-size:1.05rem; letter-spacing:.5px; color:var(--text-main); }
        .user-info p { margin:0; font-size:.8rem; color:#64748b; }

        .hidden { display:none; }

        /* Small screens */
        @media (max-width:520px){
            .form-container { padding:34px 28px 0; }
            .auth-header { padding:40px 24px 34px; }
            .container { box-shadow: 10px 10px 22px var(--shadow-dark), -10px -10px 22px var(--shadow-light); }
        }

        /* High contrast fallback toggle (optional) */
        .contrast-hint { position:absolute; top:10px; right:14px; font-size:11px; opacity:.5; }
    </style>
</head>
<body>
    <div class="container">
        <div class="auth-header">
            <h1><i class="fas fa-shield-alt"></i> Dashboard</h1>
            <p>Secure authentication Super Admin</p>
        </div>
        <!-- Login Form -->
        <div id="login-form" class="form-container">
            <div id="alert-container"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" name="email" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" name="password" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary" id="loginBtn"><span class="btn-text">Sign In</span></button>
                <button type="button" class="btn btn-secondary" id="forgotPasswordBtn">Forgot Password?</button>
            </form>
            <div class="form-toggle"></div>
        </div>
        <!-- Signup Form -->
        <div id="signup-form" class="form-container hidden">
            <div id="signup-alert-container"></div>
            <form id="signupForm">
                <div class="form-group"><label for="signupName">Full Name</label><input type="text" id="signupName" name="name" required placeholder="Enter your full name"></div>
                <div class="form-group"><label for="signupEmail">Email Address</label><input type="email" id="signupEmail" name="email" required placeholder="Enter your email"></div>
                <div class="form-group"><label for="signupPassword">Password</label><input type="password" id="signupPassword" name="password" required placeholder="Create a password" minlength="6"></div>
                <div class="form-group"><label for="confirmPassword">Confirm Password</label><input type="password" id="confirmPassword" name="confirmPassword" required placeholder="Confirm your password"></div>
                <button type="submit" class="btn btn-primary" id="signupBtn"><span class="btn-text">Create Account</span></button>
            </form>
            <div class="form-toggle">Already have an account? <a href="#" id="showLogin">Sign in here</a></div>
        </div>
        <!-- Reset Password Form -->
        <div id="reset-form" class="form-container hidden">
            <div id="reset-alert-container"></div>
            <form id="resetForm">
                <div class="form-group"><label for="resetEmail">Email Address</label><input type="email" id="resetEmail" name="email" required placeholder="Enter your email"></div>
                <button type="submit" class="btn btn-primary" id="resetBtn"><span class="btn-text">Send Reset Link</span></button>
                <button type="button" class="btn btn-secondary" id="backToLogin">Back to Login</button>
            </form>
        </div>
        <!-- Dashboard -->
        <div id="dashboard" class="form-container dashboard">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar"><i class="fas fa-user"></i></div>
                <h3 id="userName">Welcome!</h3>
                <p id="userEmail"></p>
            </div>
            <button class="btn btn-secondary" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
    </div>

    <script>
        // Prevent script from running multiple times
        if (!window.authScriptInitialized) {
            window.authScriptInitialized = true;
            
            // Supabase configuration
            const SUPABASE_URL = 'https://rtfefxghfbtirfnlbucb.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0ZmVmeGdoZmJ0aXJmbmxidWNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1MDg3OTcsImV4cCI6MjA1NjA4NDc5N30.fb7_myCmFzbV7WPNjFN_NEl4z0sOmRCefnkQbk6c10w';
            
            // Initialize Supabase client
            window.__supabaseClients = window.__supabaseClients || {};
            window.supabaseClient = window.__supabaseClients[SUPABASE_URL] || window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            window.__supabaseClients[SUPABASE_URL] = window.supabaseClient;
            
            const supabase = window.supabaseClient;
            const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const resetForm = document.getElementById('reset-form');
        const dashboard = document.getElementById('dashboard');

        const loginFormEl = document.getElementById('loginForm');
        const signupFormEl = document.getElementById('signupForm');
        const resetFormEl = document.getElementById('resetForm');

        const showSignupBtn = document.getElementById('showSignup');
        const showLoginBtn = document.getElementById('showLogin');
        const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
        const backToLoginBtn = document.getElementById('backToLogin');
        const logoutBtn = document.getElementById('logoutBtn');

        const alertContainer = document.getElementById('alert-container');
        const signupAlertContainer = document.getElementById('signup-alert-container');
        const resetAlertContainer = document.getElementById('reset-alert-container');

        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const userAvatar = document.getElementById('userAvatar');

        function showAlert(container,msg,type='error'){ container.innerHTML = `<div class="alert alert-${type}">${msg}</div>`; setTimeout(()=>{ container.innerHTML=''; },5000); }
        function setLoading(btn,loading){ const txt = btn.querySelector('.btn-text'); if(loading){ btn.disabled=true; txt.innerHTML='<span class="loading"></span> Processing...'; } else { btn.disabled=false; txt.innerHTML = btn.id==='loginBtn'? 'Sign In': btn.id==='signupBtn'? 'Create Account':'Send Reset Link'; } }
        function showForm(form){ [loginForm, signupForm, resetForm, dashboard].forEach(f=>f.classList.add('hidden')); form.classList.remove('hidden'); }
        function getInitials(name){ return name? name.split(' ').map(n=>n[0]).join('').toUpperCase():'U'; }

        async function handleLogin(e){
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            setLoading(loginBtn,true);
            try{
                const { error } = await supabase.auth.signInWithPassword({ email, password });
                if(error) throw error;
                
                // Check if there's a returnTo parameter
                const urlParams = new URLSearchParams(window.location.search);
                const returnTo = urlParams.get('returnTo');
                
                if(returnTo) {
                    showAlert(alertContainer,`Login successful! Redirecting to ${returnTo}...`,'success');
                    setTimeout(()=>{ window.location.href = `./${returnTo}`; },1200);
                } else {
                    showAlert(alertContainer,'Login successful! Redirecting to admin dashboard...','success');
                    setTimeout(()=>{ window.location.href='./admin-dashboard.html'; },1200);
                }
            }catch(err){ showAlert(alertContainer, err.message||'Login failed'); }
            finally{ setLoading(loginBtn,false); }
        }

        async function handleSignup(e){
            e.preventDefault();
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const signupBtn = document.getElementById('signupBtn');
            if(password !== confirmPassword){ showAlert(signupAlertContainer,'Passwords do not match!'); return; }
            setLoading(signupBtn,true);
            try{
                const { error } = await supabase.auth.signUp({ email, password, options:{ data:{ full_name:name } } });
                if(error) throw error;
                showAlert(signupAlertContainer,'Account created! Check your email.','success');
                setTimeout(()=>{ showForm(loginForm); },1800);
            }catch(err){ showAlert(signupAlertContainer, err.message||'Signup failed'); }
            finally{ setLoading(signupBtn,false); }
        }

        async function handlePasswordReset(e){
            e.preventDefault();
            const email = document.getElementById('resetEmail').value.trim();
            const resetBtn = document.getElementById('resetBtn');
            setLoading(resetBtn,true);
            try{
                const { error } = await supabase.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin });
                if(error) throw error;
                showAlert(resetAlertContainer,'Password reset link sent!','success');
                setTimeout(()=>{ showForm(loginForm); },2000);
            }catch(err){ showAlert(resetAlertContainer, err.message||'Reset failed'); }
            finally{ setLoading(resetBtn,false); }
        }

        async function handleLogout(){ try{ const { error } = await supabase.auth.signOut(); if(error) throw error; showForm(loginForm); loginFormEl.reset(); signupFormEl.reset(); resetFormEl.reset(); }catch(err){ console.error('Logout error',err); } }

        function showDashboard(user){ const name = user.user_metadata?.full_name || user.email.split('@')[0]; userName.textContent = `Welcome, ${name}!`; userEmail.textContent = user.email; userAvatar.innerHTML = getInitials(name); showForm(dashboard); }

        loginFormEl.addEventListener('submit', handleLogin);
        signupFormEl.addEventListener('submit', handleSignup);
        resetFormEl.addEventListener('submit', handlePasswordReset);
        logoutBtn.addEventListener('click', handleLogout);
        if(showSignupBtn){ showSignupBtn.addEventListener('click', e=>{ e.preventDefault(); showForm(signupForm); }); }
        if(showLoginBtn){ showLoginBtn.addEventListener('click', e=>{ e.preventDefault(); showForm(loginForm); }); }
        forgotPasswordBtn.addEventListener('click', ()=>{ showForm(resetForm); });
        backToLoginBtn.addEventListener('click', ()=>{ showForm(loginForm); });

        supabase.auth.getSession().then(({ data:{ session } })=>{ 
            if(session){ 
                // Check if there's a returnTo parameter
                const urlParams = new URLSearchParams(window.location.search);
                const returnTo = urlParams.get('returnTo');
                
                if(returnTo) {
                    window.location.href = `./${returnTo}`;
                } else {
                    window.location.href='./admin-dashboard.html'; 
                }
            } 
        });
        supabase.auth.onAuthStateChange((event, session)=>{ if(event==='SIGNED_IN' && session){ console.log('User signed in'); } else if(event==='SIGNED_OUT'){ showForm(loginForm); } });

        document.getElementById('confirmPassword').addEventListener('input', function(){ const pass=document.getElementById('signupPassword').value; const v=this.value; if(v && pass!==v){ this.classList.add('error'); this.classList.remove('success'); } else if(v && pass===v){ this.classList.add('success'); this.classList.remove('error'); } else { this.classList.remove('error','success'); } });
        
        } // End of authScriptInitialized check
    </script>
</body>
</html>

