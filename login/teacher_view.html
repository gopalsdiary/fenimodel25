<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>View Teacher Details</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./auth-check_copy.js"></script>

  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#f6f8fa;color:#24292f;}
    header{background:#0d1117;color:#fff;padding:14px 20px;display:flex;align-items:center;justify-content:space-between;}
    h1{margin:0;font-size:20px;font-weight:600;}
    a.back{color:#58a6ff;text-decoration:none;font-size:13px;}
    a.back:hover{text-decoration:underline;}
    .wrap{max-width:1200px;margin:24px auto 80px;background:#fff;padding:22px 26px 40px;border:1px solid #d0d7de;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.05);}    
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px 20px;}
    .grid.wide{grid-template-columns:repeat(auto-fill,minmax(300px,1fr));}
    label{display:block;font-size:11px;font-weight:600;letter-spacing:.5px;text-transform:uppercase;color:#57606a;margin:0 0 4px;}
    .field-display{width:100%;box-sizing:border-box;padding:8px 9px;border:1px solid #d0d7de;border-radius:5px;font-size:13px;background:#f8f9fa;color:#24292f;min-height:20px;}
    .field-display.empty{color:#6a737d;font-style:italic;}
    .actions{margin-top:28px;display:flex;gap:12px;flex-wrap:wrap;}
    button{cursor:pointer;padding:9px 18px;border-radius:5px;border:1px solid #0366d6;background:#0366d6;color:#fff;font-size:14px;font-weight:600;}
    button:hover{background:#024c9e;}
    button.outline{background:#fff;color:#0366d6;}
    button.outline:hover{background:#e7f3ff;}
    .status{margin-top:12px;font-size:14px;min-height:22px;}
    .status.ok{color:#1a7f37;} .status.err{color:#d73a49;}
    .two-col{display:flex;flex-wrap:wrap;gap:26px;margin-top:20px;}
    .panel{flex:1 1 460px;min-width:360px;background:#fafbfc;padding:16px 18px 22px;border:1px solid #d8dee4;border-radius:6px;}
    .panel h2{margin:0 0 14px;font-size:16px;font-weight:600;}
    .photo-preview{width:120px;height:120px;border:1px solid #d0d7de;border-radius:6px;object-fit:cover;background:#fff;margin-top:4px;cursor:pointer;}
    .photo-preview:hover{opacity:0.9;box-shadow:0 2px 8px rgba(0,0,0,0.15);}
    .muted{color:#57606a;font-size:12px;}
    .view-header{background:#e7f3ff;border:1px solid #b6e3ff;border-radius:6px;padding:12px 16px;margin-bottom:20px;color:#0969da;}
    .view-header h2{margin:0;font-size:16px;font-weight:600;}
    .view-btn{padding:6px 12px;font-size:12px;background:#0366d6;border-color:#0366d6;color:#fff;margin-top:8px;display:inline-block;}
    .view-btn:hover{background:#024c9e;}
  </style>
</head>
<body>
  <header>
    <h1>View Teacher Details</h1>
    <a class="back" href="teacherlist.html">‚Üê Back to list</a>
  </header>
  <div class="wrap">
    <div class="view-header">
      <h2>üëÅÔ∏è Teacher Information (Read Only)</h2>
      <p style="margin:8px 0 0;font-size:13px;">All teacher information is displayed below in read-only format. Use the Edit button from the teacher list to make changes.</p>
    </div>
    <div id="loadStatus" class="status"></div>
    <div id="teacherDetails"></div>
    <div class="actions">
    </div>
  </div>

<script>
const supabaseUrl = 'https://rtfefxghfbtirfnlbucb.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0ZmVmeGdoZmJ0aXJmbmxidWNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1MDg3OTcsImV4cCI6MjA1NjA4NDc5N30.fb7_myCmFzbV7WPNjFN_NEl4z0sOmRCefnkQbk6c10w';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
const TABLE='teacher_database';

const FIELD_GROUPS = [
  { title:'Identity', fields:['iid','teacher_name_en','teacher_name_bn','pp_photo','nid_photo'] },
  { title:'Designation & Sector', fields:['sector','designation_en','designation_bn','subject_en','subject_bn','index_number','pds_number','pay_code','basic','1st_mpo'] },
  { title:'Parents', fields:['father_name_en','father_name_bn','mother_name_en','mother_name_bn'] },
  { title:'Personal', fields:['date_of_birth_en','date_of_birth_bn','gender_en','gender_bn','religion_en','religion_bn','nid_number_en','nid_number_bn','birth_certificate_number'] },
  { title:'Contact', fields:['mobile_number_en','mobile_number_bn','teacher_email_id'] },
  { title:'Banking', fields:['bank_account_number','bank_account_number2'] },
  { title:'Addresses', fields:['village_en','village_bn','post_office_en','post_office_bn','upazilla_en','upazilla_bn','district_en','district_bn','home_district'] },
  { title:'Service', fields:['this_school_join_date','join_date','created_at'] },
];

const LABELS = { 
  iid:'IID', 
  teacher_name_en:'Teacher Name (EN)', 
  teacher_name_bn:'Teacher Name (BN)', 
  pp_photo:'Profile Photo URL', 
  nid_photo:'NID Photo URL', 
  sector:'Sector', 
  designation_en:'Designation (EN)', 
  designation_bn:'Designation (BN)', 
  subject_en:'Subject (EN)', 
  subject_bn:'Subject (BN)', 
  index_number:'Index Number', 
  pds_number:'PDS Number', 
  pay_code:'Pay Code', 
  basic:'Basic', 
  '1st_mpo':'1st MPO', 
  father_name_en:'Father Name (EN)', 
  father_name_bn:'Father Name (BN)', 
  mother_name_en:'Mother Name (EN)', 
  mother_name_bn:'Mother Name (BN)', 
  date_of_birth_en:'DOB (EN)', 
  date_of_birth_bn:'DOB (BN)', 
  gender_en:'Gender (EN)', 
  gender_bn:'Gender (BN)', 
  religion_en:'Religion (EN)', 
  religion_bn:'Religion (BN)', 
  nid_number_en:'NID (EN)', 
  nid_number_bn:'NID (BN)', 
  birth_certificate_number:'Birth Certificate No', 
  mobile_number_en:'Mobile (EN)', 
  mobile_number_bn:'Mobile (BN)', 
  teacher_email_id:'Email', 
  bank_account_number:'Bank A/C 1',
  bank_account_number2:'Bank A/C 2',
  village_en:'Village (EN)', 
  village_bn:'Village (BN)', 
  post_office_en:'Post Office (EN)', 
  post_office_bn:'Post Office (BN)', 
  upazilla_en:'Upazilla (EN)', 
  upazilla_bn:'Upazilla (BN)', 
  district_en:'District (EN)', 
  district_bn:'District (BN)', 
  home_district:'Home District', 
  this_school_join_date:'This School Join Date', 
  join_date:'Join Date', 
  created_at:'Created At' 
};

let currentTeacher = null;

function qs(k){return new URLSearchParams(location.search).get(k);} 
function setStatus(el,msg,type=''){ el.textContent=msg||''; el.className='status'+(type?' '+type:''); }

async function load(){
  const iid = qs('iid');
  if(!iid){ setStatus(loadStatus,'Missing iid parameter','err'); return; }
  setStatus(loadStatus,'Loading teacher #'+iid+' ...');
  const { data, error } = await supabase.from(TABLE).select('*').eq('iid', iid).single();
  if(error){ setStatus(loadStatus,'Load failed: '+error.message,'err'); return; }
  currentTeacher = data;
  buildDisplay(data);
  setStatus(loadStatus,'Loaded','ok');
}

function buildDisplay(row){
  const container = document.getElementById('teacherDetails');
  container.innerHTML='';
  
  FIELD_GROUPS.forEach(group=>{
    const panel = document.createElement('section');
    panel.className='panel';
    const h2=document.createElement('h2'); h2.textContent=group.title; panel.appendChild(h2);
    const grid=document.createElement('div'); grid.className='grid';
    
    group.fields.forEach(field=>{
      if(!(field in row)) return; // skip absent fields
      
      const wrap=document.createElement('div');
      const label=document.createElement('label'); 
      label.textContent=LABELS[field]||field; 
      wrap.appendChild(label);
      
      const fieldValue = row[field];
      const displayDiv = document.createElement('div');
      displayDiv.className = 'field-display';
      
      if(!fieldValue || fieldValue === '') {
        displayDiv.textContent = '‚Äî';
        displayDiv.classList.add('empty');
      } else {
        displayDiv.textContent = fieldValue;
      }
      
      wrap.appendChild(displayDiv);
      
      // Check if it's a URL/photo field
      const isUrlField = field.includes('url') || field.includes('photo');
      
      // Add photo previews for URL/photo fields
      if(isUrlField && row[field]){
        const img=document.createElement('img'); 
        img.src=row[field]; 
        img.alt=field; 
        img.className='photo-preview';
        img.onclick=()=>window.open(row[field],'_blank');
        wrap.appendChild(img);
        
        // Add View button
        const viewBtn=document.createElement('button');
        viewBtn.type='button';
        viewBtn.className='view-btn';
        viewBtn.textContent='üëÅÔ∏è View';
        viewBtn.onclick=()=>window.open(row[field],'_blank');
        wrap.appendChild(viewBtn);
      }
      
      grid.appendChild(wrap);
    });
    panel.appendChild(grid);
    container.appendChild(panel);
  });
  
  // Add other fields that are not in groups
  addOtherFields(row, container);
}

// Add fields that are not in groups
function addOtherFields(row, container){
  const allGroupFields = FIELD_GROUPS.flatMap(g => g.fields);
  const remainingFields = Object.keys(row).filter(key => !allGroupFields.includes(key));
  
  if(remainingFields.length > 0){
    const panel = document.createElement('section');
    panel.className='panel';
    const h2=document.createElement('h2'); h2.textContent='Other Fields'; panel.appendChild(h2);
    const grid=document.createElement('div'); grid.className='grid';
    
    remainingFields.forEach(field=>{
      const wrap=document.createElement('div');
      const label=document.createElement('label'); 
      label.textContent=field.replace(/_/g,' ').replace(/\b\w/g, l => l.toUpperCase()); 
      wrap.appendChild(label);
      
      const fieldValue = row[field];
      const displayDiv = document.createElement('div');
      displayDiv.className = 'field-display';
      
      if(!fieldValue || fieldValue === '') {
        displayDiv.textContent = '‚Äî';
        displayDiv.classList.add('empty');
      } else {
        displayDiv.textContent = fieldValue;
      }
      
      wrap.appendChild(displayDiv);
      
      // Check if it's a photo/URL field
      const isPhotoField = field.includes('_url') || field.toLowerCase().includes('photo') || field.includes('url');
      
      // Photo preview for URL/photo fields
      if(isPhotoField && row[field]){
        const img=document.createElement('img'); 
        img.src=row[field]; 
        img.alt=field; 
        img.className='photo-preview';
        img.onclick=()=>window.open(row[field],'_blank');
        wrap.appendChild(img);
        
        // Add View button
        const viewBtn=document.createElement('button');
        viewBtn.type='button';
        viewBtn.className='view-btn';
        viewBtn.textContent='üëÅÔ∏è View';
        viewBtn.onclick=()=>window.open(row[field],'_blank');
        wrap.appendChild(viewBtn);
      }
      
      grid.appendChild(wrap);
    });
    panel.appendChild(grid);
    container.appendChild(panel);
  }
}

const loadStatus=document.getElementById('loadStatus');


load();
</script>
</body>
</html>