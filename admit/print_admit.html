<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admit Card â€” Print</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link href="https://fonts.maateen.me/kalpurush/font.css" rel="stylesheet">
  <style>
    :root{ --bg:#f6f7f9; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:'Noto Sans Bengali','Hind Siliguri', system-ui, Arial, sans-serif; background:var(--bg); color:#111 }
    header{ position:sticky; top:0; background:#fff; border-bottom:1px solid #e5e7eb; z-index:10 }
    .container{ max-width:980px; margin:0 auto; padding:1rem }
    h1{ margin:.25rem 0; text-align:center; font-size:1.1rem }
  .card-wrap{ display:flex; justify-content:center; padding:1rem }
  /* Visible frame sized exactly 93x90mm */
  .print-frame{ width:93mm; height:90mm; background:#fff; display:block; position:relative; overflow:hidden; border:0.5mm solid #000 }
  /* Design canvas sized exactly to the frame (positions are ratio-mapped for 93x90mm) */
  .card{ position:absolute; left:0; top:0; width:93mm; height:90mm; background:#fff url('./admit.png') center no-repeat; background-size:100% 100%; border:none; box-shadow:0 10px 30px rgba(0,0,0,.08) }
  .t{ position:absolute; font-family:'Times New Roman', Times, serif; color:#111; line-height:1.12; -webkit-font-smoothing:antialiased; text-rendering:geometricPrecision }
  /* Center watermark image */
  .watermark{ position:absolute; left:50%; top:60%; transform:translate(-50%,-50%); width:58mm; max-width:60%; height:auto; opacity:.12; pointer-events:none; filter:grayscale(100%) }
  .labelled::before{ content: attr(data-label) ' : '; font-weight:400; margin-right:1.5mm }
  /* Ratio-mapped positions and sizes for 93x90mm */
  .t.name{ font-size:3.75mm; font-weight:700; letter-spacing:.2mm; text-transform:uppercase; white-space:normal; overflow-wrap:anywhere }
    .t.class{ font-size:3.91mm }
    .t.section{ font-size:3.91mm; text-transform:uppercase }
  /* Flow container so name can wrap and push subsequent lines */
  .info-block{ position:absolute; left:4.43mm; right:4.43mm; top:51.44mm }
  .info-block .t{ position:static; display:block }
  .info-block .row{ display:flex; align-items:flex-end; justify-content:space-between; gap:6mm }
  /* Sizes */
  .t.name{ font-size:3.75mm; font-weight:700; letter-spacing:.2mm; text-transform:uppercase; white-space:normal; overflow-wrap:anywhere; margin:0 0 2mm 0 }
  .t.class{ font-size:3.91mm }
  .t.section{ font-size:3.91mm; text-transform:uppercase; text-align:right }
  .t.roll{ font-size:4.9mm; font-weight:700; max-width:46mm; overflow:hidden; white-space:nowrap; text-overflow:ellipsis }
  .t.iid{ font-size:3.91mm; font-weight:400; white-space:nowrap; max-width:38mm; text-align:right }
  .t.group{ font-size:3.52mm; font-weight:400; text-align:right; margin-top:1.2mm }
  .t.exam{ left:0; top:36.65mm; width:100%; text-align:center; font-weight:700; font-size:4.32mm; text-decoration: underline; text-underline-offset: 1mm; text-decoration-thickness: .4mm }
    .t.year{ left:61.29mm; top:40.70mm; font-weight:400; font-size:3.60mm }
  /* School header */
  .t.school-name{ left:0; top:2.70mm; width:100%; text-align:center; font-weight:400; font-size:8.92mm; color:#111 }
  .t.school-address{ left:0; top:12.52mm; width:100%; text-align:center; font-weight:400; font-size:3.52mm; color:#111 }
  /* Admit Card badge under address */
  .t.admit-badge{ left:50%; top:17.22mm; transform:translateX(-50%);
    background:#777; color:#fff; padding:3.29mm 8.22mm; border-radius:4.11mm;
    font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;
    font-weight:400; font-size:8.22mm; line-height:1; white-space:nowrap }
  /* Footer signatures */
  .t.class-teacher{ left:6.64mm; bottom:2mm; font-weight:400; font-size:3.52mm; color:#111 }
  .t.headteacher{ right:6.64mm; bottom:2mm; font-weight:400; font-size:3.52mm; color:#111 }
  /* QR/Barcode removed */
    .actions{ display:flex; gap:.5rem; justify-content:center; padding:1rem }
    .btn{ display:inline-flex; align-items:center; gap:.45rem; padding:.5rem .9rem; border:1px solid #d1d5db; border-radius:10px; background:#fff; cursor:pointer; font-weight:600 }
    .btn.primary{ background:#0ea5e9; border-color:#0284c7; color:#fff }
  @media print{ header,.actions{ display:none !important } body{ background:#fff } @page{ size:A4; margin:3mm } .card-wrap{ padding:0 } .card{ box-shadow:none; border:1px solid #000 } }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    function q(n, d=''){ const v=new URLSearchParams(location.search).get(n); return v==null?d:v; }
    function text(el, v){ el.textContent = v==null? '': String(v); }
  function upper(s){ return String(s||'').toUpperCase(); }
    function setPos(selector, prop, qname){
      const v = q(qname, null); if(v===null || v==='') return;
      const el = document.querySelector(selector); if(!el) return;
      const num = Number(v); if(Number.isFinite(num)) el.style[prop] = num + 'mm';
    }
    function sanitizeFilename(s){ return String(s||'').replace(/[\\/:*?"<>|]+/g,'').trim().replace(/\s+/g,'_').slice(0,120) || 'Admit_Card'; }
    function downloadPDF(){
      if(typeof html2pdf === 'undefined'){ alert('PDF library not loaded. Please check your internet connection.'); return; }
    const frame = document.querySelector('.print-frame');
      const name = (document.querySelector('.t.name')?.textContent || '').trim();
      const rollText = (document.querySelector('.t.roll')?.textContent || '').trim();
      const roll = rollText.split(/\s+IID\b/i)[0].trim();
      const examLine = (document.querySelector('.t.exam')?.textContent || '').trim();
      const filename = sanitizeFilename(`Admit_${examLine}_${roll}_${name}`) + '.pdf';
      const opt = {
        margin:       0,
        filename,
        image:        { type: 'jpeg', quality: 0.95 },
        html2canvas:  { scale: 2, useCORS: true, backgroundColor: null },
          jsPDF:        { unit: 'mm', format: [93,90], orientation: 'portrait' }
      };
        html2pdf().set(opt).from(frame).save();
    }
  function render(){
      const data = {
        exam: q('exam',''),
        year: q('year',''),
        name: q('name',''),
    father: q('father',''),
        cls: q('cls', q('class','')),
        section: q('section',''),
    roll: q('roll', q('ROLL', q('Roll',''))),
  iid: q('iid', q('IID', q('Iid',''))),
  group: q('GROUP', q('group', q('Group', q('grp', q('GRP','')))))
      };
      // Background template switch (use bg=sample to compare with sample.jpg)
  const bg = q('bg','admit');
  const card = document.querySelector('.card');
      if(bg && bg.toLowerCase().startsWith('sample')){ card.style.backgroundImage = "url('./sample.jpg')"; }
      else{ card.style.backgroundImage = "url('./admit.png')"; }
  document.querySelector('.t.exam').textContent = [data.exam, data.year].filter(Boolean).join(' - ');
  const nameEl = document.querySelector('.t.name'); nameEl.classList.add('labelled'); nameEl.setAttribute('data-label','Name'); nameEl.textContent = upper(data.name);
  const classEl = document.querySelector('.t.class'); classEl.classList.add('labelled'); classEl.setAttribute('data-label','Class'); classEl.textContent = data.cls;
  const secEl = document.querySelector('.t.section'); secEl.classList.add('labelled'); secEl.setAttribute('data-label','Section'); secEl.textContent = upper(data.section);
  const rollEl = document.querySelector('.t.roll'); rollEl.classList.add('labelled'); rollEl.setAttribute('data-label','Roll'); rollEl.style.whiteSpace='nowrap';
  rollEl.textContent = `${data.roll||''}`;
  const iidEl = document.querySelector('.t.iid'); iidEl.classList.add('labelled'); iidEl.setAttribute('data-label','IID'); iidEl.style.whiteSpace='nowrap'; iidEl.textContent = data.iid ? `${data.iid}` : '';
  // Group (only for class 9 & 10)
  const groupEl = document.querySelector('.t.group');
  if(groupEl){
    const clsNum = parseInt(String(data.cls||'').match(/\d+/)?.[0]||'',10);
    const grp = String(data.group||'').trim();
    if((clsNum===9 || clsNum===10) && grp){
      groupEl.classList.remove('labelled');
      groupEl.removeAttribute('data-label');
      groupEl.textContent = upper(grp);
      groupEl.style.display = 'block';
    }else{
      groupEl.style.display = 'none';
      groupEl.textContent = '';
    }
  }
  // Optional position overrides via query params (values in mm)
  setPos('.t.name','left','name_left'); setPos('.t.name','top','name_top');
  // father field removed
  setPos('.t.class','left','class_left'); setPos('.t.class','top','class_top');
  setPos('.t.section','left','section_left'); setPos('.t.section','top','section_top');
  setPos('.t.roll','left','roll_left'); setPos('.t.roll','top','roll_top');
  setPos('.t.exam','left','exam_left'); setPos('.t.exam','top','exam_top');
  setPos('.t.year','left','year_left'); setPos('.t.year','top','year_top');
  setPos('.t.iid','left','iid_left'); setPos('.t.iid','top','iid_top');
  setPos('.t.admit-badge','left','badge_left'); setPos('.t.admit-badge','top','badge_top');
  // No scaling needed: positions are defined for the 93x90mm canvas
  // QR removed
    }
    window.addEventListener('DOMContentLoaded', render);
  </script>
</head>
<body>
  <header>
    <div class="container"><h1>Admit Card Preview</h1></div>
  </header>
  <div class="card-wrap">
    <div class="print-frame">
      <div class="card">
  <img class="watermark" src="./logowatermark.png" alt="" decoding="async" />
      <div class="t school-name">Feni Model High School</div>
      <div class="t school-address">Trunk Road, Feni</div>
  <div class="t admit-badge">Admit Card</div>
      <div class="t exam"></div>
      <div class="t year"></div>
  <div class="info-block">
          <div class="t name"></div>
          <div class="row">
            <div class="t class"></div>
            <div class="t section"></div>
          </div>
          <div class="row">
            <div class="t roll"></div>
            <div class="t iid"></div>
          </div>
          <div class="t group" style="display:none"></div>
        </div>
      <div class="t class-teacher">Class Teacher</div>
      <div class="t headteacher">Headteacher</div>
      </div>
    </div>
  </div>
  <div class="actions">
  <button class="btn" onclick="window.print()">Print</button>
  <button class="btn" onclick="downloadPDF()">Download PDF</button>
  </div>
  
</body>
</html>
