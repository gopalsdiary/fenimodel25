<!doctype html>
<html lang="bn">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>বিস্তারিত তথ্য</title>
	<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
	<link href="https://fonts.maateen.me/kalpurush/font.css" rel="stylesheet">
	<style>
		:root { color-scheme: light dark; }
		body { margin:0; font-family:'Kalpurush','Hind Siliguri', system-ui, Arial, sans-serif; background:#f6f7f9; color:#111; }
		header { position:sticky; top:0; background:#fff; border-bottom:1px solid #e5e7eb; z-index:10; }
		.container { max-width:900px; margin:0 auto; padding:1rem; }
		h1 { margin:.25rem 0; font-size:1.15rem; text-align:center; }
		.toolbar { display:flex; gap:.6rem; align-items:center; justify-content:center; flex-wrap:wrap; margin:.4rem 0 .8rem; }
		/* Admission form box styling */
		.form-box { background:#fff; border:2px solid #f97316; border-radius:14px; box-shadow:0 10px 30px rgba(249,115,22,.12); padding:1.1rem 1.2rem 1.25rem; }
		.image-container { text-align:center; margin-bottom:1rem; }
		.student-image { max-width:150px; max-height:200px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,.15); }
		.form-head { display:flex; align-items:flex-end; justify-content:space-between; gap:1rem; margin:0 0 .8rem; border-bottom:2px solid #e5e7eb; padding-bottom:.5rem; }
		.form-title { margin:0; font-size:1.2rem; letter-spacing:.4px; }
		.form-meta { margin:0; font-size:.82rem; color:#64748b; text-align:right; }
	dl { display:grid; grid-template-columns: 240px 1fr; column-gap:1rem; row-gap:.12rem; margin:0; }
		dt { font-weight:800; color:#374151; align-self:center; }
		dt::after { content:' :'; font-weight:400; color:#9ca3af; }
	dd { margin:0; color:#111; padding: .06rem 0 .1rem; border-bottom:1px solid #cbd5e1; min-height:0.9rem; }
	/* Group header style: centered and bold, full-width within the form box (reduced spacing) */
	.group-header { grid-column: 1 / -1; text-align:center; font-weight:800; padding:.18rem 0; margin:.08rem 0; border-bottom:1px solid transparent; font-size:1rem; text-decoration: underline; text-underline-offset: 2px; }
		.actions { display:flex; gap:.6rem; justify-content:center; margin-top:1rem; }
		.btn { display:inline-block; padding:.5rem .8rem; border:1px solid #d0d7de; border-radius:8px; background:#fff; text-decoration:none; color:#111; font-size:.85rem; cursor:pointer; }
		.btn:hover { background:#f3f4f6; }
		.muted { color:#6b7280; }
		@media print {
			@page { margin:0.3cm; }
			header { display:none; }
			body { background:#fff; }
			.container { max-width:100%; padding:0; }
			.form-box { box-shadow:none; border-color:#000; }
			.form-head { border-bottom-color:#000; }
			dl { row-gap:.4rem; }
			dd { border-bottom-color:#000; }
		}
		@media (prefers-color-scheme: dark){
			body { background:#0b1020; color:#e5e7eb; }
			header, .form-box { background:#111729; border-color:#075985; }
			.form-head { border-bottom-color:#263148; }
			dt { color:#cbd5e1; } dd { color:#e5e7eb; border-bottom-color:#334155; }
			dt::after { color:#94a3b8; }
			.btn { background:#111729; color:#e5e7eb; border-color:#263148; }
			.btn:hover { background:#0f162a; }
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

	<script>
		// Supabase config
		const supabaseUrl = 'https://rtfefxghfbtirfnlbucb.supabase.co';
		const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0ZmVmeGdoZmJ0aXJmbmxidWNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1MDg3OTcsImV4cCI6MjA1NjA4NDc5N30.fb7_myCmFzbV7WPNjFN_NEl4z0sOmRCefnkQbk6c10w';
		const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
		const tableName = 'student_database';

		function byParam(name){
			const url = new URL(window.location.href);
			return url.searchParams.get(name);
		}

		function esc(s){ return String(s ?? ''); }

		async function loadColumnOrder(){
			try{
				const res = await fetch('dataorder.csv');
				const txt = await res.text();
				const lines = txt.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
				const spec = [];
				for(const line of lines){
					if(line.toLowerCase().includes('colm name')) continue;
					const parts = line.split(' > ');
					if(parts.length >= 2){
						const field = parts[0].trim();
						const label = parts[1].trim();
						if(field) spec.push({ field, label });
					}else{
						// If the line doesn't have ' > ' but starts with '*' treat it as a group header
						if(line.startsWith('*')){
							spec.push({ field: null, label: line });
						}
					}
				}
				return spec;
			}catch(e){ return []; }
		}

		async function loadAndDisplayImage(iid){
			// Placeholder for image loading if needed
		}

		async function init(){
			const iidParam = byParam('iid');
			const head = document.getElementById('head');
			const status = document.getElementById('status');
			const meta = document.getElementById('meta');
			head.textContent = 'বিস্তারিত তথ্য';
			if(!iidParam){
				status.textContent='No IID provided';
				return;
			}
			status.textContent='Loading…';
			try{
				const columnSpec = await loadColumnOrder();
				const { data, error } = await supabase
					.from(tableName)
					.select('*')
					.eq('iid', Number(iidParam))
					.single();
				if(error) throw error;
				if(!data){
					status.textContent='Record not found';
					return;
				}
				meta.textContent = `IID: ${iidParam}`;
				loadAndDisplayImage(iidParam);
				const dl = document.getElementById('dl');
				let shown=0;
				const fieldsToShow = columnSpec.length > 0 ? columnSpec : Object.keys(data).map(f => ({field: f, label: f}));
				fieldsToShow.forEach(spec => {
					const label = (spec.label || spec.field || '').trim();
					// If the label starts with '*' treat it as a group header and render centered bold
					if(label.startsWith('*')){
						const h = document.createElement('div');
						h.className = 'group-header';
						// remove leading '*' and trim
						h.textContent = label.replace(/^\*+/, '').trim();
						dl.appendChild(h);
						return;
					}
					const valRaw = data[spec.field];
					const val = esc(valRaw);
					const dt = document.createElement('dt');
					dt.textContent = label;
					const dd = document.createElement('dd');
					dd.textContent = val || '';
					dl.appendChild(dt);
					dl.appendChild(dd);
					shown++;
				});
				status.textContent = 'Ready';
			}catch(e){
				console.error(e);
				status.textContent = 'Failed to load';
			}
		}
		window.addEventListener('DOMContentLoaded', init);
	</script>
</head>
<body>
	<header>
		<div class="container">
			<h1 id="head">বিস্তারিত তথ্য</h1>
			<div class="toolbar">
				<span id="status" class="muted"></span>
			</div>
		</div>
	</header>
	<main>
		<div class="container">
			<div class="form-box">
				<div class="form-head">
					<h2 class="form-title">ভর্তি ফরম</h2>
					<p class="form-meta" id="meta"></p>
				</div>
				<div id="image-container" class="image-container"></div>
				<dl id="dl"></dl>
				<hr>
				<div class="actions no-print">
					<button class="btn" onclick="window.print()">Print</button>
				</div>
			</div>
		</div>
	</main>
</body>
</html>
