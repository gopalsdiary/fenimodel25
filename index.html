<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feni Model High School ‚Äì Result & Document Portal</title>
    <link rel="stylesheet" href="style.css">
    <!-- iOS / PWA install icons and meta (helps 'Add to Home Screen' on iPhone/iPad) -->
    <link rel="apple-touch-icon" sizes="180x180" href="logo2.png">
    <link rel="apple-touch-icon" sizes="152x152" href="logo2.png">
    <link rel="apple-touch-icon" sizes="120x120" href="logo2.png">
    <link rel="icon" href="logo2.png" sizes="any">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Feni Model">
    <meta name="theme-color" content="#2563eb">
    <!-- Add security headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <!-- Kalpurush Bangla font -->
    <link href="https://fonts.maateen.me/kalpurush/font.css" rel="stylesheet">
    
        <style>
            :root {
                --bg: #f5f7fb;
                --bg-alt:#ffffff;
                --text:#1f2d3d;
                --text-soft:#546170;
                --brand:#2563eb;
                --brand-accent:#1d4ed8;
                --danger:#dc2626;
                --success:#15803d;
                --radius:18px;
                --border:#e2e8f0;
                --shadow:0 6px 20px -2px rgba(0,0,0,.08),0 2px 6px -1px rgba(0,0,0,.04);
            }
            /* Increase global font sizing by ~15% */
            html { font-size:115%; }
            .dark {
                --bg:#0d1117; --bg-alt:#161b22; --text:#e6edf3; --text-soft:#94a3b8; --border:#263445; --shadow:0 6px 24px -4px rgba(0,0,0,.6);
            }
            * { box-sizing:border-box; }
            body { margin:0; font-family:'Kalpurush','Noto Sans Bengali','Hind Siliguri','SolaimanLipi','Vrinda','Siyam Rupali', system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased; }
            h1 { font-size:clamp(2.09rem,3.3vw,2.64rem); margin:.25rem 0 0; font-weight:700; letter-spacing:.5px; background:linear-gradient(90deg,#0ea5e9,#6366f1,#10b981); -webkit-background-clip:text; background-clip:text; color:transparent; text-decoration: underline; text-underline-offset:4px; text-decoration-thickness:2px; text-decoration-color:#0ea5e9; }
            header.site-head { position:relative; padding:1.3rem 1.25rem 1rem; display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap; }
            .brand-badge { font-size:.7rem; letter-spacing:1px; padding:.35rem .6rem; border:1px solid var(--border); border-radius:999px; background:linear-gradient(120deg,var(--bg-alt),rgba(255,255,255,.4)); -webkit-backdrop-filter:blur(6px); backdrop-filter:blur(6px); }
            .mode-toggle { background:var(--bg-alt); border:1px solid var(--border); color:var(--text-soft); padding:.55rem .9rem; border-radius:10px; font-size:.75rem; font-weight:600; cursor:pointer; display:inline-flex; align-items:center; gap:.45rem; box-shadow:var(--shadow); transition:.35s; }
            .mode-toggle:hover { color:var(--text); }
            .container { width:100%; max-width:1150px; margin:0 auto; padding:0 1.2rem 3rem; }
            .gate-card { margin:2.2rem auto 2.8rem; max-width:420px; background:var(--bg-alt); border:1px solid var(--border); border-radius:var(--radius); padding:2.25rem 2.1rem 2.4rem; box-shadow:var(--shadow); position:relative; overflow:hidden; }
            .gate-card:before { content:""; position:absolute; inset:0; background:radial-gradient(circle at 85% 15%,rgba(99,102,241,.15),transparent 60%); pointer-events:none; }
            .gate-title { margin:0 0 .35rem; font-size:1.4rem; font-weight:600; display:flex; align-items:center; gap:.55rem; }
            .gate-desc { margin:0 0 1.1rem; font-size:.85rem; color:var(--text-soft); }
            .password-input { width:100%; padding:.9rem 1rem; font-size:.95rem; border:2px solid var(--border); border-radius:12px; background:var(--bg); transition:border-color .3s, background .3s; }
            .password-input:focus { outline:none; border-color:var(--brand); background:var(--bg-alt); }
            .pw-actions { display:flex; gap:.7rem; margin-top:.9rem; align-items:center; }
            .password-btn { flex:1; background:linear-gradient(90deg,#10b981,#059669); border:none; color:#fff; font-weight:600; padding:.85rem 1.1rem; border-radius:12px; cursor:pointer; font-size:.9rem; letter-spacing:.5px; box-shadow:0 4px 14px -2px rgba(16,185,129,.4); transition:.35s; }
            .password-btn:hover { filter:brightness(1.05); transform:translateY(-2px); }
            .show-toggle { background:var(--bg-alt); border:1px solid var(--border); padding:.75rem 1rem; border-radius:12px; font-size:.7rem; font-weight:600; cursor:pointer; }
            .error-message { display:none; margin-top:.65rem; font-size:.75rem; font-weight:600; color:var(--danger); letter-spacing:.4px; }
            .exam-section { display:none; animation:fade .6s ease; }
            @keyframes fade { from { opacity:0; transform:translateY(12px);} to { opacity:1; transform:translateY(0);} }
            .logout-bar { display:flex; justify-content:flex-end; gap:.7rem; align-items:center; margin:1rem 0 1.5rem; }
            .logout-btn { background:linear-gradient(90deg,#ef4444,#dc2626); color:#fff; border:none; padding:.6rem 1rem; border-radius:10px; cursor:pointer; font-size:.7rem; font-weight:600; letter-spacing:.5px; box-shadow:0 4px 14px -2px rgba(239,68,68,.4); transition:.3s; }
            .logout-btn:hover { filter:brightness(1.05); }
            .grid { --min:260px; display:grid; gap:1.4rem; grid-template-columns:repeat(auto-fit,minmax(var(--min),1fr)); margin-top:1.2rem; }
            .card-link { position:relative; display:flex; flex-direction:column; gap:.75rem; padding:1.15rem 1.15rem 1.35rem; background:var(--bg-alt); border:1px solid var(--border); border-radius:20px; text-decoration:none; color:var(--text); box-shadow:var(--shadow); overflow:hidden; min-height:160px; }
            .card-link:before { content:""; position:absolute; inset:0; background:linear-gradient(145deg,rgba(37,99,235,.08),transparent 55%); opacity:.9; pointer-events:none; transition:.5s; }
            .card-link:hover:before { background:linear-gradient(145deg,rgba(37,99,235,.18),transparent 60%); }
            .card-link:hover { transform:translateY(-4px); }
            .card-icon { font-size:1.9rem; line-height:1; }
            .card-title { font-size:1.05rem; font-weight:700; letter-spacing:.4px; }
            .card-desc { font-size:.72rem; color:var(--text-soft); margin-top:-.35rem; line-height:1.25; }
            .tag { position:absolute; top:.7rem; right:.7rem; font-size:.77rem; background:var(--brand); color:#fff; padding:.45rem .7rem .5rem; border-radius:999px; letter-spacing:.65px; font-weight:600; box-shadow:0 2px 6px rgba(0,0,0,.25); }
            .tag.alt { background:#dc2626; }
            .tag.green { background:#059669; }
            footer { margin:3rem 0 1.5rem; text-align:center; font-size:.6rem; color:var(--text-soft); }
            .note { margin:2rem 0 0; font-size:.7rem; color:var(--text-soft); text-align:center; }
            .pulse { position:absolute; inset:0; background:radial-gradient(circle at 25% 15%,rgba(14,165,233,.25),transparent 70%); mix-blend-mode:overlay; animation:pulse 8s linear infinite; opacity:.4; pointer-events:none; }
            @keyframes pulse { 0% { transform:scale(1); opacity:.45;} 50% { transform:scale(1.15); opacity:.25;} 100% { transform:scale(1); opacity:.45;} }
            @media (max-width:640px){ .gate-card { padding:1.8rem 1.4rem 2.1rem; } .grid { --min:220px; } }
            /* Emphasize group headings */
            .year-head, .section-head { font-weight:800 !important; color:var(--text); letter-spacing:.9px; }
            /* Colored group themes */
            .year-group { position:relative; border:1px solid var(--border); border-radius:24px; padding:1.1rem 1.1rem 1.35rem; -webkit-backdrop-filter:blur(3px); backdrop-filter:blur(3px); }
            .year-group:before { content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none; mix-blend-mode:overlay; }
            .group-2025 { background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(16,185,129,.05)); border-color:rgba(16,185,129,.35); }
            .group-2024 { background:linear-gradient(135deg,rgba(99,102,241,.18),rgba(99,102,241,.06)); border-color:rgba(99,102,241,.40); }
            .group-docs { background:linear-gradient(135deg,rgba(245,158,11,.22),rgba(245,158,11,.07)); border-color:rgba(245,158,11,.45); margin-top:2.2rem; }
            .group-2025 .year-head span.line { background:linear-gradient(90deg,#10b981,transparent); }
            .group-2024 .year-head span.line { background:linear-gradient(90deg,#6366f1,transparent); }
            .group-docs .section-head span { background:linear-gradient(90deg,#f59e0b,transparent)!important; }
            .group-2025 .card-link:before { background:linear-gradient(145deg,rgba(16,185,129,.25),transparent 60%); }
            .group-2024 .card-link:before { background:linear-gradient(145deg,rgba(99,102,241,.28),transparent 55%); }
            .group-docs .card-link:before { background:linear-gradient(145deg,rgba(245,158,11,.35),transparent 55%); }
            .dark .group-2025 { background:linear-gradient(135deg,rgba(16,185,129,.3),rgba(16,185,129,.12)); border-color:rgba(16,185,129,.55); }
            .dark .group-2024 { background:linear-gradient(135deg,rgba(99,102,241,.35),rgba(99,102,241,.14)); border-color:rgba(99,102,241,.6); }
            .dark .group-docs { background:linear-gradient(135deg,rgba(245,158,11,.45),rgba(245,158,11,.16)); border-color:rgba(245,158,11,.6); }
                /* Year specific card accents */
                .card-link.year-2025 { border-color:rgba(16,185,129,.55); }
                .card-link.year-2025:before { background:linear-gradient(145deg,rgba(16,185,129,.22),transparent 55%); }
                .card-link.year-2025 .tag { background:#059669; }
                .dark .card-link.year-2025 { border-color:rgba(16,185,129,.7); }
                .card-link.year-2024 { border-color:rgba(99,102,241,.55); }
                .card-link.year-2024:before { background:linear-gradient(145deg,rgba(99,102,241,.25),transparent 55%); }
                .card-link.year-2024 .tag { background:#6366f1; }
                .dark .card-link.year-2024 { border-color:rgba(99,102,241,.7); }
                /* Future years template (copy & adjust color)
                    .card-link.year-2026 { border-color:rgba(14,165,233,.55); }
                    .card-link.year-2026 .tag { background:#0ea5e9; } */
        </style>
</head>
<body oncontextmenu="return false;" onselectstart="return false;" oncopy="return false;">
        <header class="site-head">
            <div style="display:flex;align-items:center;gap:.85rem;flex-wrap:wrap;">
                <h1>Feni Model High School</h1>
                <span class="brand-badge">RESULT ¬∑ Testimonial - Transfer Certificate</span>
            </div>
            <button class="mode-toggle" id="modeToggle" aria-label="Toggle dark mode">üåô Theme</button>
        </header>
        <div class="container">
            <section id="passwordSection" class="gate-card" aria-labelledby="gateTitle">
                <span class="pulse"></span>
                <h2 id="gateTitle" class="gate-title">üîê Secure Access</h2>
                <p class="gate-desc">Enter the authorized passcode to open the examination & certificate modules.</p>
                <input id="passwordInput" class="password-input" type="password" inputmode="numeric" autocomplete="current-password" placeholder="Enter password" aria-describedby="errorMessage" onkeypress="handlePasswordKeyPress(event)">
                <div class="pw-actions">
                    <button class="password-btn" onclick="checkPassword()">Unlock Portal</button>
                    <button type="button" class="show-toggle" id="togglePw" aria-pressed="false" onclick="togglePassword()">SHOW</button>
                </div>
                <div class="error-message" id="errorMessage" role="alert">Incorrect password. Please try again.</div>
                <div style="margin-top:1.1rem; font-size:.6rem; color:var(--text-soft); letter-spacing:.5px;">Session auto‚Äëexpires after 15 minutes of inactivity.</div>
            </section>

            <section id="examSection" class="exam-section" aria-labelledby="portalTitle">
                <div class="logout-bar">
                    <button class="mode-toggle" id="modeToggle2" onclick="toggleMode()" aria-label="Toggle dark mode (secondary)">üåì</button>
                    <button class="logout-btn" onclick="logout()">LOGOUT</button>
                    <button type="button" class="show-toggle" onclick="clearSessionStorage()">Clear SessionStorage</button>

                </div>
                <h2 id="portalTitle" style="margin:0 0 .25rem;font-size:1.55rem;letter-spacing:.5px;">Student Modules & Exam Modules</h2>
                <p style="margin:.15rem 0 1.3rem;font-size:.82rem;color:var(--text-soft);max-width:680px;">Choose a module below grouped by academic year. Use a desktop computer for best printing accuracy. <strong style="color:var(--danger);">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶´‡ßã‡¶® ‡¶è‡¶°‡¶º‡¶ø‡¶Ø‡¶º‡ßá ‡¶ö‡¶≤‡ßÅ‡¶®</strong>.</p>
                <style>
                    .year-group { margin:1.6rem 0 0; }
                    .year-head { display:flex; align-items:center; gap:.65rem; font-size:1rem; font-weight:600; letter-spacing:.6px; color:var(--text-soft); text-transform:uppercase; margin:0 0 .75rem; }
                    .year-head span.line { flex:0 0 42px; height:2px; background:linear-gradient(90deg,var(--brand),transparent); border-radius:2px; }
                </style>
                <!-- Top quick links -->
                <div class="grid" role="list" aria-label="Top quick links">
                    <a role="listitem" href="0database/index.html" class="card-link year-2025" aria-label="Student Database - class wise (Feni Model)">
                        <span class="tag green">2025</span>
                        <span class="card-icon">üßÆ</span>
                        <span class="card-title">Student Database - class wise (‡¶´‡ßá‡¶®‡ßÄ ‡¶Æ‡¶°‡ßá‡¶≤)</span>
                        <span class="card-desc">Mid‚Äësession performance (open module).</span>
                    </a>
                    <a role="listitem" href="https://modelteachersdata.netlify.app/" class="card-link" aria-label="Teachers information">
                        <span class="tag">Teachers</span>
                        <span class="card-icon">üë©‚Äçüè´</span>
                        <span class="card-title">Teachers information</span>
                        <span class="card-desc">Faculty directory and staff details.</span>
                    </a>
                    <a role="listitem" href="student_count.html" class="card-link" aria-label="Student count summary">
                        <span class="tag">Count</span>
                        <span class="card-icon">üìà</span>
                        <span class="card-title">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶Ø‡ßã‡¶ó‡¶´‡¶≤ (‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂)</span>
                        <span class="card-desc">Section‚Äëwise totals with links to the detailed list.</span>
                    </a>
                </div>
                <div class="year-group" id="year-2025">
                    <h3 class="year-head"><span class="line"></span> 2025 Examination</h3>
                    <div class="grid" role="list" aria-label="2025 Examination Modules">
                        <a role="listitem" href="terminal25 sheet/index.html" class="card-link year-2025" aria-label="Half Yearly Examination 2025">
                            <span class="tag green">2025</span>
                            <span class="card-icon">üßÆ</span>
                            <span class="card-title">Half Yearly Examination 2025 (‡¶´‡ßá‡¶®‡ßÄ ‡¶Æ‡¶°‡ßá‡¶≤)</span>
                            <span class="card-desc">Mid‚Äësession performance (open module).</span>
                        </a>
                        <a role="listitem" href="0idpass/searchpassword.html" class="card-link year-2025" aria-label="Half Yearly Examination 2025">
                            <span class="tag green">2025</span>
                            <span class="card-icon">üßÆ</span>
                            <span class="card-title">student id password </span>
                            <span class="card-desc">Mid‚Äësession performance (open module).</span>
                        </a>
                        <a role="listitem" href="https://modelresult.netlify.app/" class="card-link year-2025" aria-label="Half Yearly Examination 2025">
                            <span class="tag green">Student Login </span>
                            <span class="card-icon">üßÆ</span>
                            <span class="card-title">student login </span>
                            <span class="card-desc">Student login module.</span>
                        </a>
                    </div>
                </div>
                <div class="year-group" id="year-2024">
                    <h3 class="year-head"><span class="line"></span> 2024 Examination</h3>
                    <div class="grid" role="list" aria-label="2024 Examination Modules">
                        <a role="listitem" href="ann24/index.html" class="card-link year-2024" aria-label="Annual Examination 2024 (Another School)">
                            <span class="tag alt">2024</span>
                            <span class="card-icon">üìä</span>
                            <span class="card-title">Annual Examination 2024 (‡¶Ö‡¶®‡ßç‡¶Ø ‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤)</span>
                            <span class="card-desc">External / collaborating institution dataset.</span>
                        </a>
                        <a role="listitem" href="ann24s/index.html" class="card-link year-2024" aria-label="Annual Examination 2024 (Feni Model)">
                            <span class="tag">2024</span>
                            <span class="card-icon">üìã</span>
                            <span class="card-title">Annual Examination 2024 (‡¶´‡ßá‡¶®‡ßÄ ‡¶Æ‡¶°‡ßá‡¶≤)</span>
                            <span class="card-desc">Official annual academic results archive.</span>
                        </a>
                    </div>
                </div>
                <div class="year-group group-docs" id="group-docs">
                    <h3 class="section-head" style="margin:0 0 .9rem;font-size:1.05rem;letter-spacing:.8px;text-transform:uppercase;color:var(--text-soft);display:flex;align-items:center;gap:.55rem;">
                        <span style="width:38px;height:2px;background:linear-gradient(90deg,#f59e0b,transparent);"></span> Certificates & Testimonials
                    </h3>
                    <div class="grid subgrid" role="list" id="certGrid" style="--min:260px;">
                                <a role="listitem" href="TC/test_list.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag">TC</span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title">Transfer Certificates</span>
                                    <span class="card-desc">Lookup & verify issued transfer certificates.</span>
                                </a>
                                <a role="listitem" href="ssc_testomonial/test_list.html" class="card-link" aria-label="SSC Testimonial module">
                                    <span class="tag alt">SSC 2025</span>
                                    <span class="card-icon">üéì</span>
                                    <span class="card-title">SSC Testimonials (‡¶è‡¶∏.‡¶è‡¶∏.‡¶∏‡¶ø -‡¶™‡ßç‡¶∞‡¶∂‡¶Ç‡¶∏‡¶æ ‡¶™‡¶§‡ßç‡¶∞) </span>
                                    <span class="card-desc">Session‚Äëwise testimonial verification list.</span>
                                </a>
                                <a role="listitem" href="Protoyon/test_list.html" class="card-link" aria-label="School Testimonial module">
                                    <span class="tag alt">School ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡ßü‡¶®</span>
                                    <span class="card-icon">üéì</span>
                                    <span class="card-title">‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡ßü‡¶® ‡¶™‡¶§‡ßç‡¶∞ (‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤) </span> 
                                    <span class="card-desc">ID‚Äëwise testimonial verification list.</span>
                                </a>
                    </div>
            
                </div>
                
             <div class="grid subgrid" role="list" id="certGrid" style="--min:260px;">
                                <a role="listitem" href="admit/admitlist.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag">Admit Card</span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title">‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂‡¶™‡¶§‡ßç‡¶∞ (Admit Card)</span>
                                    <span class="card-desc">‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶£ Admit cards </span>
                                </a>
                                <a role="listitem" href="seatplan/admitlist.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag">Seat</span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title"> ‡¶∏‡ßÄ‡¶ü ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶® (Seat plan)</span>
                                    <span class="card-desc">Create  seat plans.</span>
                                </a>
                                <a role="listitem" href="photo/downloder.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag">Photo</span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title"> student photo</span>
                                    <span class="card-desc">Lookup   issued photo.</span>
                                </a>
                                <a role="listitem" href="idcard/test_list.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag">id card</span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title"> student id card</span>
                                    <span class="card-desc">Lookup & verify issued id card.</span>
                                </a>
                                 <a role="listitem" href="sms/regular_excel_sms.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag">SMS</span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title">SMS List and Management</span>
                                    <span class="card-desc">Lookup & see sended SMS.</span>
                                </a>
                                <a role="listitem" href="photoupload/photo_upload.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag">Photo</span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title"> student photo Upload</span>
                                    <span class="card-desc">Lookup  issued photo.</span>
                                </a>
                                <a role="listitem" href=" " class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag"> Attendance </span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title"> Attendance System </span>
                                    <span class="card-desc">Lookup  issued Attendance.</span>
                                </a>
                                 <a role="listitem" href="login/index.html" class="card-link" aria-label="Transfer Certificate module">
                                    <span class="tag"> Super Admin  </span>
                                    <span class="card-icon">üìë</span>
                                    <span class="card-title"> Super Admin Dashboard </span>
                                    <span class="card-desc">Edit Database</span>
                                </a>
                    </div>
                    </div>
                <p class="note">¬© <span id="year"></span> Feni Model High School ¬∑ Auto session timeout enabled ¬∑ Unauthorized access prohibited.</p>
            </section>
        </div>
        <footer>
            Powered by Gopals 
        </footer>

    <script>
        // Disable developer tools
        document.addEventListener('keydown', function (e) {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                (e.ctrlKey && e.shiftKey && e.key === 'C') || 
                (e.ctrlKey && e.key === 'U')) {
                e.preventDefault();
            }
        });
        
        // Password functionality
    const correctPassword = "1"; // TODO: move to server-side validation in production
    const SESSION_DURATION = 15 * 60 * 1000; // 15 minutes in milliseconds
    let lastActivityTime = null;

    // Password lockout settings
    const PW_LOCK_THRESHOLD = 3; // attempts
    const PW_LOCK_DURATION_MS = 5 * 60 * 1000; // 5 minutes
    const PW_FAILED_KEY = 'pw_failed_count';
    const PW_LOCK_UNTIL_KEY = 'pw_lock_until';

    function getFailedCount(){ return Number(localStorage.getItem(PW_FAILED_KEY) || 0); }
    function setFailedCount(n){ localStorage.setItem(PW_FAILED_KEY, String(n)); }
    function clearFailedAttempts(){ localStorage.removeItem(PW_FAILED_KEY); localStorage.removeItem(PW_LOCK_UNTIL_KEY); }
    function registerFailedAttempt(){
        const cnt = getFailedCount() + 1;
        setFailedCount(cnt);
        if(cnt >= PW_LOCK_THRESHOLD){
            const until = Date.now() + PW_LOCK_DURATION_MS;
            localStorage.setItem(PW_LOCK_UNTIL_KEY, String(until));
        }
    }
    function getLockRemaining(){
        const until = Number(localStorage.getItem(PW_LOCK_UNTIL_KEY) || 0);
        const now = Date.now();
        return until > now ? until - now : 0;
    }
    function isLocked(){ return getLockRemaining() > 0; }
    function formatMsRemaining(ms){
        const sec = Math.ceil(ms/1000);
        const m = Math.floor(sec/60);
        const s = sec % 60;
        if(m > 0) return `${m}m ${s}s`;
        return `${s}s`;
    }
        
        function doCheckPassword() {
            const passwordInput = document.getElementById('passwordInput');
            const errorMessage = document.getElementById('errorMessage');
            const passwordSection = document.getElementById('passwordSection');
            const examSection = document.getElementById('examSection');

            // If locked, show remaining time
            if (isLocked()) {
                const rem = getLockRemaining();
                errorMessage.textContent = `Too many attempts. Try again in ${formatMsRemaining(rem)}.`;
                errorMessage.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
                return false;
            }

            if (passwordInput.value === correctPassword) {
                // Correct password - show exam selection
                passwordSection.style.display = 'none';
                examSection.style.display = 'block';
                errorMessage.style.display = 'none';

                // Clear failed attempts on success
                clearFailedAttempts();

                // Store authentication with timestamp
                const loginTime = Date.now();
                sessionStorage.setItem('authenticated', 'true');
                sessionStorage.setItem('loginTime', loginTime.toString());
                // Initialize activity time & start timeout
                lastActivityTime = loginTime;
                attachActivityListeners();
                startSessionTimeout();
                cacheAllDataFieldIfNeeded();
                return true;
            } else {
                // Wrong password - show error and register failure
                registerFailedAttempt();
                if (isLocked()) {
                    const rem = getLockRemaining();
                    errorMessage.textContent = `Too many attempts. Try again in ${formatMsRemaining(rem)}.`;
                } else {
                    errorMessage.textContent = 'Incorrect password. Please try again.';
                }
                errorMessage.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();

                // Add shake animation
                passwordInput.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    passwordInput.style.animation = '';
                }, 500);
                return false;
            }
        }
        
        function handlePasswordKeyPress(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        }
        
        function isSessionValid() {
            const authenticated = sessionStorage.getItem('authenticated');
            const loginTime = sessionStorage.getItem('loginTime');
            
            if (authenticated !== 'true' || !loginTime) {
                return false;
            }
            
            const currentTime = new Date().getTime();
            const sessionAge = currentTime - parseInt(loginTime);
            
            return sessionAge < SESSION_DURATION;
        }
        
    function logout() {
            // Clear session data
            sessionStorage.removeItem('authenticated');
            sessionStorage.removeItem('loginTime');
            lastActivityTime = null;
            
            // Show password section and hide exam section
            document.getElementById('passwordSection').style.display = 'block';
            document.getElementById('examSection').style.display = 'none';
            
            // Clear password input and focus
            document.getElementById('passwordInput').value = '';
            document.getElementById('passwordInput').focus();
            
            // Clear any session timeout
            if (window.sessionTimeoutId) {
                clearTimeout(window.sessionTimeoutId);
            }
        }
        
        function startSessionTimeout() {
            if (window.sessionTimeoutId) clearTimeout(window.sessionTimeoutId);
            const now = Date.now();
            if(!lastActivityTime) lastActivityTime = now;
            const remaining = (lastActivityTime + SESSION_DURATION) - now;
            if (remaining <= 0) {
                alert('Your session has expired. Please log in again.');
                logout();
                return;
            }
            window.sessionTimeoutId = setTimeout(() => {
                alert('Your session has expired. Please log in again.');
                logout();
            }, remaining);
        }

        function recordActivity(){
            if(sessionStorage.getItem('authenticated') !== 'true') return;
            lastActivityTime = Date.now();
            startSessionTimeout();
        }
        function attachActivityListeners(){
            ['click','keydown','mousemove','scroll','touchstart'].forEach(evt=>{
                window.addEventListener(evt, recordActivity, { passive:true });
            });
        }
        
        function checkSessionValidity() {
            if (sessionStorage.getItem('authenticated') === 'true') {
                if (isSessionValid()) {
                    document.getElementById('passwordSection').style.display = 'none';
                    document.getElementById('examSection').style.display = 'block';
                    // Do NOT restart timeout here to avoid perpetual extension; start/refresh only on activity
                    cacheAllDataFieldIfNeeded();
                } else {
                    logout();
                }
            }
        }
        
                function togglePassword(){
                    const input=document.getElementById('passwordInput');
                    const btn=document.getElementById('togglePw');
                    const visible=input.type==='text';
                    input.type= visible ? 'password':'text';
                    btn.textContent= visible ? 'SHOW':'HIDE';
                    btn.setAttribute('aria-pressed', (!visible).toString());
                }

                // Cache 0newdatabase/all_data_field.html in SessionStorage for 5 minutes
                const ALL_DATA_KEY = 'all_data_field_html';
                const ALL_DATA_EXP_KEY = 'all_data_field_html_expires';
                const ALL_DATA_TTL = 5 * 60 * 1000; // 5 minutes

                function scheduleAllDataExpiry(timeoutMs){
                    if(window.__allDataExpiryTimer) clearTimeout(window.__allDataExpiryTimer);
                    if(timeoutMs>0){
                        window.__allDataExpiryTimer = setTimeout(()=>{
                            sessionStorage.removeItem(ALL_DATA_KEY);
                            sessionStorage.removeItem(ALL_DATA_EXP_KEY);
                        }, timeoutMs);
                    }
                }

                async function cacheAllDataFieldIfNeeded(){
                    try{
                        const now = Date.now();
                        const exp = Number(sessionStorage.getItem(ALL_DATA_EXP_KEY) || 0);
                        const cached = sessionStorage.getItem(ALL_DATA_KEY);
                        if(cached && exp && now < exp){
                            scheduleAllDataExpiry(exp - now);
                            return;
                        }
                        const res = await fetch('0newdatabase/all_data_field.html', { cache:'no-store' });
                        if(!res.ok) return;
                        const text = await res.text();
                        const expiresAt = now + ALL_DATA_TTL;
                        sessionStorage.setItem(ALL_DATA_KEY, text);
                        sessionStorage.setItem(ALL_DATA_EXP_KEY, String(expiresAt));
                        scheduleAllDataExpiry(ALL_DATA_TTL);
                    }catch(e){ /* ignore */ }
                }

                function initAllDataCacheOnLoad(){
                    const now = Date.now();
                    const exp = Number(sessionStorage.getItem(ALL_DATA_EXP_KEY) || 0);
                    if(exp && now < exp){
                        scheduleAllDataExpiry(exp - now);
                    } else {
                        sessionStorage.removeItem(ALL_DATA_KEY);
                        sessionStorage.removeItem(ALL_DATA_EXP_KEY);
                    }
                }

                function clearSessionStorage(){
                    try{ sessionStorage.clear(); }catch(e){}
                    // Also cancel any timers related to session & cached data
                    if(window.sessionTimeoutId){ try{ clearTimeout(window.sessionTimeoutId); }catch(_){} window.sessionTimeoutId = null; }
                    if(window.__allDataExpiryTimer){ try{ clearTimeout(window.__allDataExpiryTimer); }catch(_){} window.__allDataExpiryTimer = null; }
                    // Reset activity tracking
                    lastActivityTime = null;
                    // Return UI to login state
                    const passwordSection = document.getElementById('passwordSection');
                    const examSection = document.getElementById('examSection');
                    if(passwordSection && examSection){
                        passwordSection.style.display = 'block';
                        examSection.style.display = 'none';
                    }
                    const pw = document.getElementById('passwordInput');
                    if(pw){ pw.value=''; pw.focus(); }
                    alert('SessionStorage cleared. Please log in again.');
                }

                // Theme toggle (persist)
                function applyMode(m){ document.documentElement.classList.toggle('dark', m==='dark'); }
                function toggleMode(){ const cur=localStorage.getItem('theme')==='dark'?'light':'dark'; localStorage.setItem('theme',cur); applyMode(cur); }
                document.getElementById('modeToggle').addEventListener('click',toggleMode);
                // Secondary toggle if visible later
                function initSecondaryToggle(){ const mt2=document.getElementById('modeToggle2'); if(mt2) mt2.onclick=toggleMode; }

                // On load
                window.onload = function() {
                        const saved= localStorage.getItem('theme'); if(saved) applyMode(saved); else if(window.matchMedia('(prefers-color-scheme: dark)').matches) applyMode('dark');
                        checkSessionValidity();
                        initAllDataCacheOnLoad();
                        if(sessionStorage.getItem('authenticated')==='true'){
                            lastActivityTime = Date.now();
                            attachActivityListeners();
                            startSessionTimeout();
                            cacheAllDataFieldIfNeeded();
                        }
                        initSecondaryToggle();
                        document.getElementById('year').textContent = new Date().getFullYear();
                };
        
        // Check session validity periodically (every minute)
    setInterval(() => { checkSessionValidity(); }, 60000);
        
        // Add shake animation for wrong password
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
    document.head.appendChild(style);

    // Install popup styles
    const installStyle = document.createElement('style');
    installStyle.textContent = `
        .install-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .install-popup.hidden {
            display: none;
        }

        .install-content {
            background: var(--bg-alt);
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            position: relative;
        }

        .install-logo {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            margin: 0 auto 1rem;
            display: block;
        }

        .install-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0 0 0.5rem;
            color: var(--text);
        }

        .install-message {
            font-size: 0.9rem;
            color: var(--text-soft);
            margin: 0 0 1.5rem;
            line-height: 1.4;
        }

        .install-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }

        .install-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .install-btn.primary {
            background: linear-gradient(90deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.4);
        }

        .install-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .install-btn.secondary {
            background: var(--bg);
            color: var(--text-soft);
            border: 1px solid var(--border);
        }

        .install-btn.secondary:hover {
            background: var(--border);
        }

        .install-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-soft);
            padding: 0.25rem;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .install-close:hover {
            background: var(--bg);
            color: var(--text);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media (max-width: 480px) {
            .install-content {
                padding: 1.5rem;
                margin: 1rem;
            }

            .install-title {
                font-size: 1.2rem;
            }

            .install-buttons {
                flex-direction: column;
            }

            .install-btn {
                width: 100%;
            }
        }
    `;
    document.head.appendChild(installStyle);

    // Install popup functionality
    function createInstallPopup() {
        const popup = document.createElement('div');
        popup.id = 'installPopup';
        popup.className = 'install-popup hidden';
        popup.innerHTML = `
            <div class="install-content">
                <button class="install-close" onclick="closeInstallPopup()">&times;</button>
                <img src="logo2.png" alt="Feni Model High School" class="install-logo">
                <h3 class="install-title">Install Our App</h3>
                <p class="install-message">
                    Get the best experience by installing our app on your device. 
                    Access all features with faster loading and offline support.
                </p>
                <div class="install-buttons">
                    <button class="install-btn primary" onclick="installApp()">Install App</button>
                    <button class="install-btn secondary" onclick="closeInstallPopup()">Maybe Later</button>
                </div>
            </div>
        `;
        document.body.appendChild(popup);
        return popup;
    }

    function showInstallPopup() {
        // Check if app is already installed
        const isInstalled = window.matchMedia('(display-mode: standalone)').matches || 
                           window.navigator.standalone === true ||
                           document.referrer.includes('android-app://') ||
                           window.deferredPrompt === null;
        
        if (isInstalled) {
            return; // Don't show popup if already installed
        }

        // Check if it's Android or iOS
        const isAndroid = /Android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        if (!isAndroid && !isIOS) {
            return; // Don't show popup for desktop
        }

        // Check if already shown today
        const lastShown = localStorage.getItem('installPopupLastShown');
        const today = new Date().toDateString();
        
        if (lastShown === today) {
            return; // Already shown today
        }

        let popup = document.getElementById('installPopup');
        if (!popup) {
            popup = createInstallPopup();
        }
        
        popup.classList.remove('hidden');
        localStorage.setItem('installPopupLastShown', today);
    }

    function closeInstallPopup() {
        const popup = document.getElementById('installPopup');
        if (popup) {
            popup.classList.add('hidden');
        }
    }

    function installApp() {
        // Try to trigger native install prompt
        if (window.deferredPrompt) {
            window.deferredPrompt.prompt();
            window.deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                }
                window.deferredPrompt = null;
                closeInstallPopup();
            });
        } else {
            // Fallback: show instructions or redirect
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            if (isIOS) {
                alert('To install: Tap the Share button, then "Add to Home Screen"');
            } else {
                alert('To install: Tap the menu button (‚ãÆ), then "Add to Home screen"');
            }
            closeInstallPopup();
        }
    }

    // Listen for beforeinstallprompt event
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        window.deferredPrompt = e;
    });

    // Modified checkPassword function to show install popup after successful login
    window.checkPassword = function() {
        const passwordInput = document.getElementById('passwordInput');
        // If locked, call doCheckPassword to show message
        if (isLocked()) {
            doCheckPassword();
            return;
        }

        const ok = doCheckPassword();
        if (ok) {
            // Show install popup after successful login
            setTimeout(() => {
                showInstallPopup();
            }, 1000); // Delay 1 second to let the page load
        }
    };
    </script>
</body>
</html>
